<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Dashboard - IoT Demo</title>
    <style type="text/css">
     #div_g {
       position: absolute;
       left: 10px;
       right: 16px;
       top: 40px;
       bottom: 26px;
     }
    </style>
    <script src="jquery-1.10.2.js"></script>

    <!-- <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"<html> -->

    <script>
     var clientList = ['rpit5',
		       'rpit3',
		       'rpit4',
		       'rpip5',
		       'rpip6',
		       'rpip7',
		       'rpip8',
		       'rpip9',
		       'rpip10'];

     var connectedColors = {
       'true': '#00FF22',
       'false':'#FF2200'
     };

     function svgMod(component, color, level, text) {
       var svg = document.getElementById("svg_image_id")
      			 .getSVGDocument();
       // Put up the text of the message; this should probably be removed
       var msg = svg.getElementById('msg');
       msg.textContent = component + ': ' + text;
       msg.style.setProperty("fill", color, "");
       try {
	 var shape = svg.getElementById(component);
	 shape.style.setProperty("fill", color, "");
	 var type = shape.getAttribute('type');
	 if (type && type == 'num') {
	   // Print the numeric 'level'
	   shape.textContent = level;
	   shape.style.setProperty("fill", color, "");
	 }
	 if (type && type == 'slider') {
	   var width = level;
	   var maxw = shape.getAttribute('maxw');
	   if (maxw) {
	     width = level > maxw ? maxw : level;
	   }
	   shape.setAttribute("width", width);
	   shape.style.setProperty("fill", color, "");
	 }
       } catch (err) {
	 console.log("component [" + component + "] not in SVG; skipping");
       }
     }

     function svgModifyTableElement(component, color, text) {
       //console.log(`svgModifyTableElement (${component}, ${color}, ${text})`);
       var svgDoc = document.getElementById("svg_image_id")
      			    .getSVGDocument();

       var svg = svgDoc.getElementsByTagName('svg')[0];

       var graphNode = svg.getElementById(component);
       //console.dir(graphNode);

       // highly dependent on graphviz dot SVG output
       var polygon1 = graphNode.children[6];
       var polygon2 = graphNode.children[7];
       //console.dir(polygon1);
       //console.dir(polygon2);
       polygon1.setAttribute('fill', color);
       if (color === '#add8e6') {
	 polygon2.setAttribute('stroke', '#ffffff');
       } else {
	 polygon2.setAttribute('stroke', '#add8e6');
       }
     }


     //function that is called once the document has loaded
     function init() {
       // FIXME: Connect to MQTT broker

       var svgDoc = document.getElementById("svg_image_id")
      			 .getSVGDocument();

       var svg = svgDoc.getElementsByTagName('svg')[0];

       // set size to match viewport
       svg.setAttribute('height', '100%');
       svg.setAttribute('width',  '100%');

       // https://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute
       //svg.setAttribute('preserveAspectRatio',  'xMinYMin meet');
       svg.setAttribute('preserveAspectRatio',  'xMidYMid meet');

       for (let c of clientList) {
	 // Initialize to the same 'lightblue'
	 svgModifyTableElement(c, '#add8e6', '');
       }

       console.dir(svg);

     };

    </script>
  </head>
  <body onload="init();"><!--Start the javascript ball rolling and connect to the mqtt broker
			      <!-- <body> -->
    <div id="div_g" ></div>
    <embed src="demotopo.svg" type="image/svg+xml" id="svg_image_id" />
  </body>
</html>
